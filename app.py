import streamlit as st
import pandas as pd
import os

# 1. í˜ì´ì§€ ê¸°ë³¸ ì„¤ì •
st.set_page_config(page_title="ë‚˜ë§Œì˜ ì´ì•¼ê¸° ìƒì„±ê¸° (í…ŒìŠ¤íŠ¸)", layout="wide")
st.title("ğŸ§ª ë‚˜ë§Œì˜ ì´ì•¼ê¸° ìƒì„±ê¸° (ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸)")

# 2. ì‚¬ì´ë“œë°”: API í‚¤ ì…ë ¥
with st.sidebar:
    api_key = st.text_input("OpenAI API Keyë¥¼ ì…ë ¥í•˜ì„¸ìš”", type="password")
    st.markdown("---")
    
    # [ìƒíƒœ ë¶„ê¸° 1] í‚¤ê°€ ì—†ì„ ë•Œ
    if not api_key:
        st.warning("âš ï¸ í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")
        st.stop() # ì—¬ê¸°ì„œ ë©ˆì¶¤
    
    # [ìƒíƒœ ë¶„ê¸° 2] í‚¤ê°€ ìˆì„ ë•Œ
    st.success("âœ… ì¸ì¦ ì™„ë£Œ!")
    os.environ["OPENAI_API_KEY"] = api_key

# 3. ë°ì´í„° ë¡œë“œ (íŒŒì¼ ì•ˆ ì½ê³ , ì—¬ê¸°ì„œ ì§ì ‘ ë§Œë“­ë‹ˆë‹¤!)
# 243ê°œ ëŒ€ì‹  ë”± 3ê°œë§Œ ìƒ˜í”Œë¡œ ë§Œë“¤ì–´ë´…ë‹ˆë‹¤.
data = pd.DataFrame({
    'ì§€ì—­': ['ì„œìš¸ ì¢…ë¡œ', 'ë¶€ì‚° í•´ìš´ëŒ€', 'ì œì£¼ë„'],
    'ìºë¦­í„°': ['ê¹€ì‹œê°„ (ê³¨ë™í’ˆ ê°€ê²Œ ì£¼ì¸)', 'ë°•íŒŒë„ (ì„œí¼)', 'í•œë¼ë´‰ (ìš”ì •)'],
    'í…Œë§ˆ': ['ì‹œê°„ì—¬í–‰', 'ì—´ì •ê³¼ ë°”ë‹¤', 'ì‹ ë¹„ë¡œìš´ ìˆ²']
})

# 4. ì•± í™”ë©´ êµ¬ì„±
st.subheader("1. ì§€ì—­ ë°ì´í„° í™•ì¸")
st.write("íŒŒì¼ ì—†ì´ ì½”ë“œì—ì„œ ì§ì ‘ ë§Œë“  ë°ì´í„°ì…ë‹ˆë‹¤.")
st.dataframe(data) # í‘œë¡œ ë³´ì—¬ì£¼ê¸°

st.subheader("2. ì´ì•¼ê¸° ì„¤ì • ì„ íƒ")
# ì„ íƒ ìƒì ë§Œë“¤ê¸°
selected_region = st.selectbox("ì–´ë–¤ ì§€ì—­ì˜ ì´ì•¼ê¸°ë¥¼ ë§Œë“¤ê¹Œìš”?", data['ì§€ì—­'])

# ì„ íƒí•œ ì§€ì—­ì— ë§ëŠ” ìºë¦­í„° ì°¾ê¸°
character_info = data[data['ì§€ì—­'] == selected_region]['ìºë¦­í„°'].values[0]
st.info(f"ì„ íƒí•˜ì‹  ì§€ì—­ì˜ ìºë¦­í„°ëŠ” **'{character_info}'** ì…ë‹ˆë‹¤.")

st.subheader("3. ì•„ì´ë””ì–´ ì…ë ¥")
user_input = st.text_area("ì–´ë–¤ ì‚¬ê±´ì´ ì¼ì–´ë‚˜ë‚˜ìš”?", placeholder="ì˜ˆ: ì£¼ì¸ê³µì´ ê³¼ê±°ë¡œ ëŒì•„ê°”ë‹¤.")

if st.button("ì´ì•¼ê¸° ìƒì„±í•˜ê¸° âœ¨"):
    if user_input:
        st.success(f"'{selected_region}'ì—ì„œ '{character_info}'ì™€ í•¨ê»˜í•˜ëŠ” ì´ì•¼ê¸°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤!")
        st.write(f"ì…ë ¥í•˜ì‹  ë‚´ìš©: {user_input}")
        st.write("---")
        st.write("ğŸ¤– (ì—¬ê¸°ì— ì‹¤ì œ AIê°€ ë§Œë“  ì´ì•¼ê¸°ê°€ ë“¤ì–´ê°ˆ ìë¦¬ì…ë‹ˆë‹¤)")
    else:
        st.warning("ì•„ì´ë””ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!")
